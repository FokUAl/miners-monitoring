<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/style.css">
    <title>Enegix</title>
</head>
<body>
    <nav>
        <div class="logo" onclick="window.location.href='/'"><img src="../static/img/logo_black.svg"></div>
        <div class="links">
            <div class="link" onclick="window.location.href='/add'">Add new ASIC</div>
            <div class="link" onclick="window.location.href='/grid'">Miners grid</div>
            <div class="link" onclick="window.location.href='/logout'">Logout</div>
        </div>
    </nav>
    <main>
        <form action="/add" id="post" method="post" class="form--add">
            <div class="form--title">Add new ASIC</div>
            <div class="form--inputs">
                <label>Select model</label>
                <select name="model">
                    <option selected value               >Antminer S17 Pro</option>
                    <option value="Antminer S17"         >Antminer S17+</option>
                    <option value="Antminer S17 67TH"    >Antminer S17+ 67TH</option>
                    <option value="Antminer S17 70TH"    >Antminer S17+ 70TH</option>
                    <option value="Antminer S17 73TH"    >Antminer S17+ 73TH</option>
                    <option value="Antminer S17 BOX+"    >Antminer S17+ BOX+</option>
                    <option value="Antminer S19"         >Antminer S19</option>
                    <option value="Avalon 1166 Pro 78TH" >Avalon 1166 Pro 78TH</option>
                    <option value="Avalon 1166 Pro 81TH" >Avalon 1166 Pro 81TH</option>
                    <option value="Avalon 1246"          >Avalon 1246 83TH</option>
                    <option value="Avalon 1246"          >Avalon 1246 85TH</option>
                    <option value="Watsminer M10"        >Watsminer M10</option>
                    <option value="Watsminer M10 New PSU">Watsminer M10 New PSU</option>
                    <option value="Watsminer M20s"       >Watsminer M20s</option>
                    <option value="Watsminer M21s"       >Watsminer M21s</option>
                    <option value="Watsminer M31s"       >Watsminer M31s</option>
                    <option value="Watsminer M31s68TH"   >Watsminer M31s68TH</option>
                </select>
                <div class="connections">
                    <input name="connection" type="radio" class="radio" id="ip-connection" value="ip" checked>
                    <label for="ip-connection">IP</label>
                    <input name="connection" type="radio" class="radio" id="mac-connection" value="mac">
                    <label for="mac-connection">MAC</label>
                </div>
                <div class="form--plus-minus">
                    <div class="plus-minus" onclick="addIP()">+</div>
                    <div class="plus-minus" onclick="removeIP()">-</div>
                </div>
                <div id="inputs-fields" class="inputs--fields">
                    <div id="input-container" class="input-container">
                        <div class="container--container">
                            <label>IP/MAC</label>
                            <input name="ip/mac" id="ip" type="text" class="container--input ip" pattern="(^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$)|(^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$)" required>
                        </div>
                        <div class="container--container">
                            <label>Shelf</label>
                            <input name="shelf" type="text" class="container--input shelf" pattern="^[1-4]$"required>
                        </div>
                        <div class="container--container">
                            <label>Row</label>
                            <input name="row" type="text" class="container--input row" pattern="^[1-8]$"required>
                        </div>
                        <div class="container--container">
                            <label>Column</label>
                            <input name="column" type="text" class="container--input column" pattern="^[1-9]|1[0]$" required>
                        </div>
                    </div>
                </div>
                <input type="submit" class="form--submit" value="Add">
            </div>
        </form>
        <div class="open-chat" onclick="openChat()">Chat Support</div>
        <div class="chat-popup" id="chat">
            <form action="/" class="form--chat">
                <div class="chat--title">Chat support</div>
                <textarea placeholder="Type message.."></textarea>
                <button class="chat--submit">Send message</button>
                <div class="chat--btn-cancel" onclick="closeChat()">Close</div>
            </form>
        </div>
    </main>
    <script>        
        const chat = document.getElementById('chat')
        const openChat = () => {
            chat.style.display = 'block'
        }
        const closeChat = () => {
            chat.style.display = 'none'
        }
        
        const containers = document.getElementById('inputs-fields')

        const addIP = () => {
            const container = document.getElementById('input-container')
            const clone = container.cloneNode(true)
            for (let i in clone.children) {
                const temp = clone.children[i].children
                for (let j in temp) {
                    if (temp[j].value !== '') {
                        temp[j].value = ''
                    }
                }
            }
            containers.appendChild(clone)
        }

        const removeIP = () => {
            if (containers.children.length > 1) {
                containers.removeChild(containers.lastElementChild)
            }
        }

        const form = document.querySelector('#post')
        const ips = document.getElementsByClassName('ip')
        const shelf = document.getElementsByClassName('shelf')
        const row = document.getElementsByClassName('row')
        const column = document.getElementsByClassName('column')
        form.addEventListener('submit', el => {
            el.preventDefault()
            const ipsArr = []
            const locationArr = []
            for (let i = 0; i < ips.length; i++) {
                if (ipsArr.indexOf(ips[i].value) != -1) {
                    alert('Every IP/MAC fields must be unique')
                    return false
                } else {
                    ipsArr.push(ips[i].value)
                }
                if (locationArr.indexOf(shelf[i].value+row[i].value+column[i].value) != -1) {
                    alert('Every Location fields must be unique')
                    console.log(locationArr)
                    return false
                } else {
                    locationArr.push(shelf[i].value+row[i].value+column[i].value)
                }
            }
            form.submit()
        })
    </script>
    {{ if . }}
    <script>
        alert('{{ . }}')
    </script>
    {{ end }}
</body>
</html>